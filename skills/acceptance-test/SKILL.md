---
name: acceptance-test
description: |
  受入テスト（UAT）スキル。エンドユーザー・業務担当者のペルソナになりきり、
  実装済みソースコード・画面・API を業務シナリオに沿って検証する。
  ST-001（システムテスト）と要件定義書を入力とし、ユーザー視点で業務要件の充足を確認し、
  受入テスト仕様・結果書（UAT-001）・不具合管理票（UAT-002）・受入完了報告書（UAT-003）を出力する。

  以下の場合に使用する：
  - 「受入テストして」「UATフェーズを実施して」「UAT-001を作成して」などの依頼
  - ST-001（システムテスト仕様・結果書）が PASS しているプロジェクトの受入テスト
  - ユーザー・発注者視点での業務要件充足確認
  - 受入完了後のリリース可否判断（UAT-003作成）

  入力: REQ-001, REQ-002, REQ-003, ST-001, ST-004（保留不具合確認）、実装済みソースコード
  出力: projects/PRJ-{NNN}/UAT/ 以下の UAT-001〜UAT-003
  配置ルール・ドキュメント定義 → references/document-list.md
---

# 受入テストスキル（UAT）

## 概要

エンドユーザーになりきり、要件定義書・システムテスト結果書・実装済みソースコードを読み込んで、業務シナリオに沿った受入テストを実施する。技術者視点ではなく**業務担当者の目線**で検証し、UAT-001〜UAT-003 を作成する。

参照ファイル：
- UAT ドキュメントテンプレート → `references/uat-templates.md`
- 配置ルール・ドキュメント定義 → `references/document-list.md`

## ユーザーペルソナの採用

受入テストでは**技術者の視点を捨て、エンドユーザー（業務担当者・発注者）になりきる**。

### ペルソナ構築手順

1. REQ-002（業務要件）から業務担当者の役割・日常業務を把握する
2. REQ-003（ユースケース）のアクター定義からペルソナ像を特定する
3. 以下の観点でペルソナを設定する：

| 設定項目 | 内容 |
|---|---|
| 役割 | REQ-003 のアクター（例: 店舗スタッフ、管理者、一般会員） |
| ITリテラシー | 業務担当者レベル（技術用語は使わない） |
| 関心事 | 業務が滞りなく回るか・操作が直感的か・エラー時に困らないか |
| 評価基準 | 要件どおりに動くか（実装の内部品質ではなく業務上の正しさ） |

### テスト中の思考

テスト実施中は常に以下の問いを持つ：

- 「この画面を初めて見たユーザーは迷わず操作できるか？」
- 「業務ルールどおりに動いているか？」（REQ-002 の業務ルールと照合）
- 「エラーが起きたとき、ユーザーは何をすればいいか分かるか？」
- 「一連の業務フロー（登録→確認→変更→削除）を通しで実行できるか？」

## テスト実施順序

```
UAT-001（受入テスト仕様・結果書）← ユーザーになりきりシナリオテストを実施しながら作成
  ↓ 完了後
UAT-002（不具合管理票）          ← テスト中随時更新。UAT-001完了後に集計
  ↓ 全不具合対応後
UAT-003（受入完了報告書）        ← リリース可否判断・関係者承認のために作成
```

## 前提確認

受入テスト開始前に以下を確認する：

1. **プロジェクト ID の確認**: PRJ-{NNN} と出力先ディレクトリ
2. **ST-001 完了の確認**: ST-001（システムテスト）が PASS していること
3. **ST-004 の保留不具合確認**: ST フェーズから持ち越された保留不具合を把握する
4. **受入基準の確認**: BSD-008 の UAT 合格基準・受入条件を確認する
5. **ソースコードの所在確認**: 実装済みコードベースのパスを把握する

## 入力ドキュメントの読み込み方針

```
最初に読む（スコープ把握・受入基準確認）
  projects/PRJ-{NNN}/BSD/BSD-008_test-plan.md          ← UAT合格基準・受入条件
  projects/PRJ-{NNN}/ST/ST-001_system-test.md          ← STテスト結果・UAT申し送り
  projects/PRJ-{NNN}/ST/ST-004_defect-list.md          ← ST保留不具合の把握

ペルソナ構築・シナリオ設計時に参照する
  projects/PRJ-{NNN}/REQ/REQ-001_system-requirements.md   ← システム要件（受入基準）
  projects/PRJ-{NNN}/REQ/REQ-002_business-requirements.md ← 業務要件・業務ルール・ペルソナ情報
  projects/PRJ-{NNN}/REQ/REQ-003_use-cases.md             ← ユースケース（シナリオ設計元・アクター定義）

テスト実施時に参照する（実装の動作確認）
  実装済みソースコード（FE: コンポーネント・画面、BE: API・ビジネスロジック）
  docs/DSD/FEAT-{NNN}_{機能名}/DSD-002_{FEAT-ID}_{機能名}.md  ← 画面構成の把握
  docs/DSD/FEAT-{NNN}_{機能名}/DSD-003_{FEAT-ID}_{機能名}.md  ← API仕様の把握
```

> ST-001 の「UATフェーズへの申し送り事項」と REQ-002 の業務ルールを必ず確認してからシナリオ設計を開始する。

## テスト実施方法（ソースコードベース検証）

UAT 環境が利用できない場合、**ソースコードを読み解いてユーザー操作をシミュレーションする**。

### 検証の進め方

1. **画面フローの追跡**: FE ソースコード（コンポーネント・ルーティング）を読み、ユーザーが操作する画面遷移を追跡する
2. **操作のシミュレーション**: 「ボタンをクリック → API 呼び出し → レスポンス処理 → 画面更新」の流れをコードから追う
3. **業務ルールの検証**: BE ソースコード（バリデーション・ビジネスロジック）が REQ-002 の業務ルールと一致するか確認する
4. **エラーハンドリングの確認**: エラー時のユーザー向けメッセージが適切か、回復手段が提示されているか確認する
5. **データフローの確認**: ユーザー入力 → バリデーション → DB 保存 → 画面反映の一連の流れを検証する

### 検証観点の優先順位

| 優先度 | 検証観点 | 確認方法 |
|---|---|---|
| 1（最優先） | 主要業務フローが正常に完了するか | FE 画面遷移 + API + BE ロジックを通しで追跡 |
| 2 | 業務ルールが正しく実装されているか | REQ-002 の各ルールと BE バリデーション/ロジックを照合 |
| 3 | エラー時にユーザーが困らないか | FE のエラーハンドリング・メッセージ表示を確認 |
| 4 | 画面の文言・表示が業務担当者に分かりやすいか | FE コンポーネントのラベル・メッセージ・UIテキストを確認 |
| 5 | ST 保留不具合が解消されているか | ST-004 の該当コード箇所を再確認 |

## 受入テストワークフロー（UAT-001）

### ステップ 1: 受入シナリオを設計する

REQ-002（業務要件）・REQ-003（ユースケース）を元に、ペルソナがたどる業務シナリオの TODO リストを作る。

```
[ ] 主要業務フロー全体の動作確認（ユーザーが実際に使う一連の操作）  ← まずこれ
[ ] 業務ルールの充足確認（REQ-002の各業務ルールが守られているか）
[ ] ST 保留不具合 BUG-NNN の再確認
[ ] 画面・帳票・メッセージの文言確認（業務担当者視点）
[ ] 異常系・エッジケースの業務シナリオ（入力ミス・中断・戻る操作）
...（テスト中に気づいたケースを随時追記）
```

テストケース ID は `UTC-{NNN}` 形式（プロジェクト内で連番）で採番する。

**シナリオ設計の原則**：
- **業務言語で記述する**: 技術用語（API、ステータスコード等）は使わず、ユーザーが行う操作と期待する結果を業務言語で書く
- **ユースケースの主シナリオ・代替シナリオを網羅する**: REQ-003 の各ユースケースに対応するシナリオを作る
- **「初めて使うユーザー」の視点を含める**: ヘルプ・ガイド・エラーメッセージの分かりやすさも検証対象
- **業務上クリティカルな操作を優先する**: 金銭・権限・データ削除に関わる操作は必ずテストする

### ステップ 2: テスト仕様を設計する

| 定義項目 | 内容 |
|---|---|
| 前提条件 | テスト実行前のシステム状態・テストデータ・ユーザー権限 |
| 操作手順 | ユーザーが実際に行う画面操作の手順（業務言語で記述） |
| 期待値 | 業務要件・ユースケースで定義された期待される動作 |

テスト仕様と結果は **同一テーブルに共存させる**（仕様設計後に結果列を埋める）。

### ステップ 3: テストを実施し結果を記録する

1. 各テストケースについて、ソースコードを追跡して操作をシミュレーションする
2. 結果（OK / NG / SKIP）を記録する
3. NG の場合は UAT-002 に不具合を登録し、BUG-ID を記録する
4. **NG 判定時は業務への影響を記載する**（例: 「注文確定ができないため業務が停止する」）

### ステップ 4: 完了判定

| 判定基準 | 内容 |
|---|---|
| PASS 条件 | 全 UTC が OK または SKIP（SKIP は理由必記）。重大度「高」の不具合が残存しないこと |
| FAIL 条件 | NG が残存（特に業務上クリティカルな項目は修正必須） |
| 品質基準 | BSD-008 の UAT 合格基準を参照 |

## 不具合管理（UAT-002）

不具合 ID は `BUG-{NNN}` 形式でプロジェクト内連番（**ST-004 の採番から継続して通番**）。

> ST-004 の BUG-NNN の続きから採番する（例: ST-004 が BUG-010 まで使用している場合、UAT-002 は BUG-011 から開始）。

**不具合の記述は業務担当者が読んで理解できる言葉で書く。** 技術的な原因ではなく、業務上何が困るかを中心に記述する。

| 重大度 | 定義 | 対応方針 |
|---|---|---|
| 高 | 業務が成立しない / 受入基準を満たさないクリティカルな不具合 | **即時報告** + 修正・再テスト必須 |
| 中 | 業務要件と動作が異なる / 一部シナリオが失敗するが回避策あり | 修正後に再テスト |
| 低 | 軽微な表示差異・文言の誤り・UX 上の改善点 | リリース判定で合否を決定 |

## 受入完了報告書（UAT-003）の作成

UAT-001・UAT-002 が完了した後、リリース可否判断のために UAT-003 を作成する。

UAT-003 に含める内容：
- テスト実施概要（期間・実施者・テスト環境）
- テスト結果サマリー（UAT-001 の集計）
- 不具合サマリー（UAT-002 の集計）
- **リリース可否判断**（PASS / CONDITIONAL PASS / FAIL）
- 残課題・保留事項とリリース後の対応方針
- 関係者承認欄

## 出力ドキュメントの作成

`references/uat-templates.md` のテンプレートを使い、以下を作成する：

| ドキュメント | 作成タイミング | 配置先 |
|---|---|---|
| UAT-001_acceptance-test.md | 受入テスト完了後 | `projects/PRJ-{NNN}/UAT/` |
| UAT-002_defect-list.md | 不具合発見の都度随時更新 | `projects/PRJ-{NNN}/UAT/` |
| UAT-003_acceptance-report.md | UAT-001・UAT-002 完了後 | `projects/PRJ-{NNN}/UAT/` |

## リリースフェーズへの申し送り原則

UAT 完了後、リリースフェーズへの申し送りを行う：

1. **リリース可否の明示**: UAT-003 にリリース可否判断を明記し、関係者の承認を得る
2. **保留不具合の引き継ぎ**: UAT-002 の保留不具合をリリース後の対応方針とともに記載する
3. **受入条件付き PASS の場合**: 条件（修正必須項目・確認事項）を明記する
4. **本番環境固有の確認事項**: テスト環境と本番環境の差異・本番でのみ確認できる事項を申し送る
