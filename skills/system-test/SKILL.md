---
name: system-test
description: |
  システムテスト（ST）スキル。結合テスト完了報告書（IT-001〜IT-003）と各種要件・設計書を入力とし、
  E2E・業務フロー全体のシステムテスト・性能テスト・セキュリティテストを実施し、
  システムテスト仕様・結果書（ST-001〜ST-004）を出力する。

  以下の場合に使用する：
  - 「システムテストして」「STフェーズを実施して」「ST-001を作成して」などの依頼
  - 全 IT-001 が完了し、IT-002・IT-003 も揃っているプロジェクトのシステムテスト
  - E2E シナリオ・業務フロー全体の検証
  - 性能テスト（負荷試験・レスポンスタイム計測）の実施
  - セキュリティテスト（脆弱性診断・認証/認可・暗号化確認）の実施
  - システムテスト完了後に ST-001〜ST-004 を作成する場合

  入力: BSD-008, REQ-003, REQ-005, REQ-006, BSD-002, IT-001_{FEAT-ID}（全FEAT-ID分）
  出力: projects/PRJ-{NNN}/ST/ 以下の ST-001〜ST-004
  配置ルール・ドキュメント定義 → references/document-list.md
---

# システムテストスキル（ST）

## 概要

結合テスト完了報告書・要件・設計書を読み込み、システム全体のE2E・性能・セキュリティテストを実施し、テスト仕様・結果書を作成する。

参照ファイル：
- ST ドキュメントテンプレート → `references/st-templates.md`
- 配置ルール・ドキュメント定義 → `references/document-list.md`

## パラメータ

| パラメータ | 説明 | 例 |
|---|---|---|
| PROJECT_ID | プロジェクトID | PRJ-001 |
| PROJECT_NAME | プロジェクト名 | initial-build |

## エージェント起動

このスキルは以下のサブエージェントを使用して作業を実行する。プロジェクト全体で 1 回実施する。

| サブエージェント | タイプ | プロンプト |
|---|---|---|
| ST 実行エージェント | general-purpose | `agents/system-test.md` |

### 起動手順

1. `agents/system-test.md` を Read で読み込む
2. `{{PROJECT_ID}}`, `{{PROJECT_NAME}}` を実際の値に置換する
3. 以下の形式で Task ツールを呼び出してサブエージェントを起動する

> **重要**: このスキルの作業はすべてサブエージェントに委譲する。マスターエージェントが直接実行してはならない。

Task ツール呼び出し:
- `subagent_type`: `"general-purpose"`
- `description`: `"ST システムテスト実行"`
- `prompt`: 置換済みの agents/system-test.md の内容全文
- `context`: `"fork"`

## テスト実施順序

```
ST-001（システムテスト: E2E・業務フロー）
  ↓ 完了後
ST-002（性能テスト: 負荷試験・レスポンスタイム）
  ↓ 完了後
ST-003（セキュリティテスト: 脆弱性診断・認証/認可）

ST-004（不具合管理票）← 全テスト中随時追記
```

| ドキュメント | 作成タイミング | 備考 |
|---|---|---|
| ST-001 | システムテスト完了後 | 最初に実施。E2E シナリオ全件 |
| ST-002 | ST-001 完了後 | 性能要件（REQ-006）を基準に判定 |
| ST-003 | ST-001 完了後（ST-002 と並行可） | セキュリティ要件（REQ-006・BSD-002）を基準に判定 |
| ST-004 | テスト中に不具合を発見した都度更新 | ST-001〜ST-003 で共通利用 |

## 前提確認

システムテスト開始前に以下を確認する：

1. **プロジェクト ID の確認**: PRJ-{NNN} と出力先ディレクトリ
2. **全 IT-001 完了の確認**: すべての FEAT-ID について IT-001 が完了していること
3. **IT-002・IT-003 の確認**: IT-002（API結合テスト）と IT-003（不具合管理票）が揃っていること
4. **テスト環境の確認**: ST 用テスト環境（本番相当）が起動していること
5. **IT-003 の保留不具合確認**: IT フェーズから持ち越された保留不具合を把握しておく
6. **BSD-008 のテスト方針確認**: ST の合格基準・品質基準を確認する

## 入力ドキュメントの読み込み方針

```
最初に読む（スコープ把握・方針確認）
  projects/PRJ-{NNN}/BSD/BSD-008_test-plan.md              ← テスト方針・ST合格基準
  projects/PRJ-{NNN}/IT/IT-003_defect-list.md              ← IT保留不具合の把握
  docs/REQ/REQ-003_use-cases.md                            ← ユースケース（E2Eシナリオの設計元）
  docs/REQ/REQ-005_feature-list.md                         ← 機能一覧（対象機能の確認）

ST-001（システムテスト）設計時に参照する
  projects/PRJ-{NNN}/IT/IT-001_{FEAT-ID}_{機能名}.md       ← 各機能の結合テスト結果・申し送り

ST-002（性能テスト）設計時に追加参照する
  docs/REQ/REQ-006_non-functional-requirements.md          ← 性能要件（レスポンスタイム・スループット基準）

ST-003（セキュリティテスト）設計時に追加参照する
  docs/REQ/REQ-006_non-functional-requirements.md          ← セキュリティ要件
  docs/BSD/BSD-002_security-design.md                      ← セキュリティ基本設計（認証/認可方式）
```

> IT-001 の「STフェーズへの申し送り事項」に記載された注意点を必ず確認してからテスト設計を開始する。

## システムテストワークフロー（ST-001）

### ステップ 1: E2E シナリオを設計する

REQ-003（ユースケース）と全 IT-001 の申し送りを元に、業務フロー全体をカバーする E2E シナリオの TODO リストを作る。

```
[ ] ユーザー登録 → ログイン → 主要機能利用 → ログアウト  ← まずこれ
[ ] 未認証ユーザーの制限確認（保護されたページへのアクセス拒否）
[ ] IT 保留不具合 BUG-NNN の再確認
...（テスト中に気づいたケースを随時追記）
```

テストシナリオケース ID は `STC-{NNN}` 形式（プロジェクト内で連番）で採番する。

**シナリオ設計の観点**：
- ユースケース（REQ-003）の主シナリオを網羅する
- FEAT をまたいで一連の業務フローを検証する
- IT フェーズの保留不具合を再確認するシナリオを含める
- 正常系・異常系・境界値を含める

### ステップ 2: テスト仕様を設計する

テストシナリオごとに以下を定義する：

| 定義項目 | 内容 |
|---|---|
| 前提条件 | テスト実行前のシステム状態・テストデータ・ユーザー状態 |
| 操作手順 | 画面操作〜API呼び出し〜結果確認の具体的な手順 |
| 期待値 | 画面表示・データ変化・システム動作 |

テスト仕様と結果は **同一テーブルに共存させる**（仕様設計後に結果列を埋める）。

### ステップ 3: テストを実施し完了判定する

1. テスト環境を確認し、必要なテストデータを準備する
2. 各テストケースを実行し、結果（OK / NG / SKIP）を記録する
3. NG の場合は ST-004 に不具合を登録し、BUG-ID を記録する
4. **重大度「高」の不具合はただちにユーザーに報告する**

| 判定基準 | 内容 |
|---|---|
| PASS 条件 | 全 STC が OK または SKIP（SKIP は理由必記） |
| FAIL 条件 | NG が残存（保留不具合は ST-004 に記録し UAT 申し送り） |
| 品質基準 | BSD-008 の ST 合格基準を参照 |

## 性能テストワークフロー（ST-002）

**ST-001 完了後に実施する。**

### ステップ 1: 性能テストを設計する

REQ-006 の性能要件（レスポンスタイム・スループット・同時接続数）を基準に、負荷テストシナリオを設計する。

```
性能テストシナリオ（PTC-{NNN} 形式）の例：
  PTC-001: 正常負荷時のレスポンスタイム確認（同時接続 N ユーザー）
  PTC-002: ピーク負荷時のスループット確認
  PTC-003: 長時間稼働時のメモリリーク確認
```

テストケース ID は `PTC-{NNN}` 形式で採番する。

### ステップ 2: 負荷テストを実施する

1. 性能テストツール（JMeter・Locust・k6 等）を準備する
2. 各シナリオを実行し、レスポンスタイム・スループット・エラー率を計測する
3. 計測結果を記録する

### ステップ 3: 性能要件充足を判定する

REQ-006 の性能要件と計測結果を照合し、合否を判定する。

| 判定基準 | 内容 |
|---|---|
| PASS 条件 | 全 PTC が REQ-006 の基準値を満たす |
| FAIL 条件 | いずれかの PTC が基準値を超過（ST-004 に不具合登録） |

## セキュリティテストワークフロー（ST-003）

**ST-001 完了後に実施する（ST-002 と並行可）。**

### ステップ 1: 脆弱性診断を実施する

OWASP Top 10 を基準に、主要な脆弱性を確認する。

```
確認項目（SEC-{NNN} 形式）の例：
  SEC-001: SQLインジェクション対策確認
  SEC-002: XSS 対策確認
  SEC-003: CSRF 対策確認
  SEC-004: 認証バイパス試験
```

テストケース ID は `SEC-{NNN}` 形式で採番する。

### ステップ 2: 認証・認可テストを実施する

BSD-002 の認証・認可設計を基準に、アクセス制御を検証する。

- 未認証アクセスの拒否確認
- 権限外リソースへのアクセス拒否確認
- セッション管理（タイムアウト・再利用防止）の確認

### ステップ 3: 暗号化・通信セキュリティを確認する

- TLS/SSL 証明書の有効性確認
- 通信経路の暗号化確認（HTTP → HTTPS リダイレクト等）
- 機密データの暗号化保存確認

## 不具合管理（ST-004）

不具合 ID は `BUG-{NNN}` 形式でプロジェクト内連番（**IT-003 の採番から継続して通番**）。

> IT-003 の BUG-NNN の続きから採番する（例: IT-003 が BUG-005 まで使用している場合、ST-004 は BUG-006 から開始）。

| 重大度 | 定義 | 対応方針 |
|---|---|---|
| 高 | システムが動作しない / E2E シナリオが致命的に失敗 / セキュリティ上のクリティカル脆弱性 | **即時ユーザー報告** + 修正待ち |
| 中 | 一部シナリオが失敗 / 性能要件未達 / セキュリティ要件との乖離 | テスト継続・修正後に再テスト |
| 低 | 軽微な表示差異・性能の軽微な乖離・セキュリティのベストプラクティス未適用 | テスト継続・UAT 申し送り検討 |

ST-004 は **全テスト種別（ST-001〜ST-003）で共通利用するファイル**。不具合発見時に随時追記する。

## 出力ドキュメントの作成

`references/st-templates.md` のテンプレートを使い、以下を作成する：

| ドキュメント | 作成タイミング | 配置先 |
|---|---|---|
| ST-001_system-test.md | システムテスト完了後 | `projects/PRJ-{NNN}/ST/` |
| ST-002_performance-test.md | 性能テスト完了後 | `projects/PRJ-{NNN}/ST/` |
| ST-003_security-test.md | セキュリティテスト完了後 | `projects/PRJ-{NNN}/ST/` |
| ST-004_defect-list.md | テスト中に不具合発生の都度更新 | `projects/PRJ-{NNN}/ST/` |

## UAT フェーズへの申し送り原則

ST 完了後、UAT フェーズへの申し送りを行う：

1. **保留不具合の引き継ぎ**: ST-004 の保留不具合を一覧化し、UAT での対応方針を記載する
2. **PASS 条件未達の場合**: FAIL 判定の理由と残課題を明記し、ユーザーに判断を仰ぐ
3. **テスト環境と本番環境の差異**: テスト環境固有の制限事項・本番での再確認事項を申し送る
4. **UAT 用テストデータの準備事項**: UAT で必要な初期データ・テストアカウントを申し送る
